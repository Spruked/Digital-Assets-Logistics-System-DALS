<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueMark Enterprise - Verify & Mint</title>
    <meta name="description" content="Review your enterprise NFT collection details and complete the bulk minting process">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            padding: 2rem 0;
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #00b4ff;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00b4ff, #0099cc, #00b4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -1px;
        }

        .subtitle {
            color: #00b4ff;
            font-size: 1.2rem;
            font-weight: 300;
        }

        /* Progress */
        .progress {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2rem 0;
            gap: 1rem;
        }

        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid #00b4ff;
            color: #00b4ff;
        }

        .step.completed { background: #00b4ff; color: white; }
        .step.active { background: #00b4ff; color: white; }

        .step-line {
            width: 60px;
            height: 2px;
            background: #00b4ff;
        }

        /* Preview Section */
        .preview-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            margin: 3rem 0;
        }

        .collection-preview {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(0, 180, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .collection-header {
            margin-bottom: 2rem;
        }

        .collection-title {
            font-size: 1.8rem;
            color: #00b4ff;
            margin-bottom: 0.5rem;
        }

        .collection-desc {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .asset-item {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(0, 180, 255, 0.2);
        }

        .asset-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .asset-name {
            font-size: 0.9rem;
            color: #00b4ff;
            margin-bottom: 0.25rem;
        }

        .asset-size {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Sidebar */
        .sidebar {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(0, 180, 255, 0.3);
            backdrop-filter: blur(10px);
            height: fit-content;
        }

        .sidebar h3 {
            color: #00b4ff;
            margin-bottom: 1rem;
        }

        .config-summary {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-label {
            opacity: 0.8;
        }

        .config-value {
            color: #00b4ff;
            font-weight: 600;
        }

        /* Gas Estimation */
        .gas-section {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .gas-title {
            color: #00b4ff;
            margin-bottom: 1rem;
        }

        .gas-breakdown {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .gas-total {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 0.5rem;
            font-weight: bold;
            color: #00ff88;
        }

        /* Timestamps */
        .timestamps {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .timestamp-item {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            font-size: 0.9rem;
        }

        /* Actions */
        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3rem 0;
        }

        .btn {
            background: linear-gradient(45deg, #00b4ff, #0099cc);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 180, 255, 0.4);
        }

        .btn.secondary {
            background: rgba(0, 0, 0, 0.8);
            color: #00b4ff;
            border: 2px solid #00b4ff;
        }

        .btn.secondary:hover {
            background: #00b4ff;
            color: white;
        }

        .btn.danger {
            background: linear-gradient(45deg, #ff4444, #cc3333);
        }

        .btn.danger:hover {
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.4);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .preview-section {
                grid-template-columns: 1fr;
            }

            .assets-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .actions {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">TRUEMARK ENTERPRISE</div>
            <div class="subtitle">Review Collection & Mint NFTs</div>
        </div>
    </header>

    <main class="container">
        <!-- Progress Indicator -->
        <div class="progress">
            <div class="step completed">1</div>
            <div class="step-line"></div>
            <div class="step completed">2</div>
            <div class="step-line"></div>
            <div class="step active">3</div>
            <div class="step-line"></div>
            <div class="step">4</div>
        </div>

        <div class="preview-section">
            <!-- Collection Preview -->
            <div class="collection-preview">
                <div class="collection-header">
                    <h2 class="collection-title" id="collectionTitle">Loading...</h2>
                    <p class="collection-desc" id="collectionDesc">Loading collection details...</p>
                </div>

                <div class="assets-grid" id="assetsGrid">
                    <!-- Assets will be populated by JavaScript -->
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <h3>Configuration Summary</h3>
                <div class="config-summary" id="configSummary">
                    <!-- Config will be populated by JavaScript -->
                </div>

                <h3>Gas Estimation</h3>
                <div class="gas-section">
                    <div class="gas-title">Estimated Costs</div>
                    <div class="gas-breakdown">
                        <span>Base Fee:</span>
                        <span id="baseFee">0.02 ETH</span>
                    </div>
                    <div class="gas-breakdown">
                        <span>Per NFT:</span>
                        <span id="perNftFee">0.005 ETH</span>
                    </div>
                    <div class="gas-breakdown">
                        <span>IPFS Storage:</span>
                        <span id="ipfsFee">0.001 ETH</span>
                    </div>
                    <div class="gas-breakdown gas-total">
                        <span>Total:</span>
                        <span id="totalFee">0.026 ETH</span>
                    </div>
                </div>

                <h3>ISS/DALS Timestamps</h3>
                <div class="timestamps">
                    <div class="timestamp-item">
                        <span>UTC:</span>
                        <span id="timestamp-utc">2025-11-10 14:30:25</span>
                    </div>
                    <div class="timestamp-item">
                        <span>Stardate:</span>
                        <span id="timestamp-stardate">9410.0762</span>
                    </div>
                    <div class="timestamp-item">
                        <span>Julian:</span>
                        <span id="timestamp-julian">2460675.123</span>
                    </div>
                    <div class="timestamp-item">
                        <span>Epoch:</span>
                        <span id="timestamp-epoch">1731263425</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button class="btn secondary" onclick="goBack()">‚Üê Back to Upload</button>
            <div>
                <button class="btn danger" onclick="cancelMint()" style="margin-right: 1rem;">Cancel</button>
                <button class="btn" onclick="confirmMint()">Confirm & Mint Collection</button>
            </div>
        </div>
    </main>

    <script>
        let collectionConfig = {};
        let assets = [];

        // Load data from previous page
        function loadPreviewData() {
            const configData = localStorage.getItem('truemark_config');
            if (!configData) {
                alert('No configuration data found. Please start from the beginning.');
                window.location.href = 'index.html';
                return;
            }

            collectionConfig = JSON.parse(configData);
            assets = collectionConfig.files || [];

            // Update collection info
            document.getElementById('collectionTitle').textContent = collectionConfig.collectionName;
            document.getElementById('collectionDesc').textContent = collectionConfig.description || 'No description provided';

            // Update assets grid
            updateAssetsGrid();

            // Update config summary
            updateConfigSummary();

            // Update gas estimation
            updateGasEstimation();
        }

        function updateAssetsGrid() {
            const grid = document.getElementById('assetsGrid');
            grid.innerHTML = assets.map(asset => `
                <div class="asset-item">
                    <div class="asset-icon">${getAssetIcon(asset.type)}</div>
                    <div class="asset-name">${truncateText(asset.name, 15)}</div>
                    <div class="asset-size">${formatFileSize(asset.size)}</div>
                </div>
            `).join('');
        }

        function updateConfigSummary() {
            const summary = document.getElementById('configSummary');
            summary.innerHTML = `
                <div class="config-item">
                    <span class="config-label">Assets:</span>
                    <span class="config-value">${assets.length}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Category:</span>
                    <span class="config-value">${collectionConfig.category || 'Not specified'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Royalty:</span>
                    <span class="config-value">${collectionConfig.royalty}%</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Edition Size:</span>
                    <span class="config-value">${collectionConfig.editionSize} per asset</span>
                </div>
                <div class="config-item">
                    <span class="config-label">IPFS Storage:</span>
                    <span class="config-value">${collectionConfig.ipfsStorage ? 'Yes' : 'No'}</span>
                </div>
                <div class="config-item">
                    <span class="config-label">Bulk Minting:</span>
                    <span class="config-value">${collectionConfig.bulkMint ? 'Enabled' : 'Disabled'}</span>
                </div>
            `;
        }

        function updateGasEstimation() {
            const baseFee = 0.02;
            const perNftFee = 0.005;
            const ipfsFee = collectionConfig.ipfsStorage ? 0.001 : 0;
            const totalFee = baseFee + (assets.length * perNftFee) + (assets.length * ipfsFee);

            document.getElementById('baseFee').textContent = `${baseFee} ETH`;
            document.getElementById('perNftFee').textContent = `${perNftFee} ETH √ó ${assets.length}`;
            document.getElementById('ipfsFee').textContent = `${ipfsFee} ETH √ó ${assets.length}`;
            document.getElementById('totalFee').textContent = `${totalFee.toFixed(3)} ETH`;
        }

        function getAssetIcon(type) {
            if (type.startsWith('image/')) return 'üñºÔ∏è';
            if (type.startsWith('video/')) return 'üé•';
            if (type.startsWith('audio/')) return 'üéµ';
            if (type.includes('pdf') || type.includes('document')) return 'üìÑ';
            return 'üìÅ';
        }

        function truncateText(text, maxLength) {
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // Update timestamps
        function updateTimestamps() {
            const now = new Date();
            document.getElementById('timestamp-utc').textContent = now.toISOString().replace('T', ' ').substring(0, 19);
            document.getElementById('timestamp-stardate').textContent = (9410 + Math.random() * 10).toFixed(4);
            document.getElementById('timestamp-julian').textContent = (2460675 + Math.random() * 100).toFixed(3);
            document.getElementById('timestamp-epoch').textContent = Math.floor(now.getTime() / 1000);
        }

        // Navigation
        function goBack() {
            window.location.href = 'upload.html';
        }

        function cancelMint() {
            if (confirm('Are you sure you want to cancel? All progress will be lost.')) {
                localStorage.removeItem('truemark_config');
                window.location.href = 'index.html';
            }
        }

        function confirmMint() {
            if (confirm(`Are you sure you want to mint ${assets.length} NFTs? This action cannot be undone and will cost approximately ${document.getElementById('totalFee').textContent}.`)) {
                // Simulate minting process
                alert('Initiating bulk minting process... (This would connect to thirdweb SDK)');

                // Simulate transaction
                setTimeout(() => {
                    alert(`Collection minted successfully! ${assets.length} NFTs created with transaction hash: 0x${Math.random().toString(16).substr(2, 64)}`);
                    window.location.href = 'certificate.html';
                }, 5000);
            }
        }

        // Initialize
        loadPreviewData();
        updateTimestamps();

        // Update timestamps every second
        setInterval(updateTimestamps, 1000);

        // Analytics tracking
        function trackEvent(event, data) {
            console.log('Analytics:', event, data);
            fetch('/api/analytics', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ event, data, timestamp: new Date().toISOString() })
            }).catch(err => console.log('Analytics error:', err));
        }

        trackEvent('page_view', { page: 'truemark_verify' });
    </script>
</body>
</html>